# https://docs.github.com/en/code-security/dependabot/working-with-dependabot/automating-dependabot-with-github-actions#automatically-approving-a-pull-request
name: Dependabot auto-approve
on: pull_request

permissions:
    pull-requests: write

env:
    CI: 1

jobs:
    dependabot:
        runs-on: ubuntu-24.04
        if: github.event.pull_request.user.login == 'dependabot[bot]' && github.repository == 'owner/my_repo'

        steps:
            - name: Fetch the Dependabot metadata
              id: metadata
              uses: dependabot/fetch-metadata@d7267f607e9d3fb96fc2fbe83e0af444713e90b7
              with:
                  github-token: "${{ secrets.GITHUB_TOKEN }}"

            - name: Checkout
              uses: actions/checkout@v4

            - name: Install pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: latest

            - name: JavaScript tests
              working-directory: javascript
              run: >-
                  pnpm i
                  && pnpm lint
                  && pnpm test

            - name: Python tests
              working-directory: python
              run: >-
                  pip install -r requirements.txt
                  && python3 main.py

            - name: C++ tests
              working-directory: cpp
              run: >-
                  g++ -o build/main.exe main.cpp
                  && ./build/main.exe

            - name: C# tests
              working-directory: csharp
              run: dotnet test

            - name: Approve the Dependabot PR
              run: gh pr review --approve "$PR_URL"
              env:
                  PR_URL: ${{github.event.pull_request.html_url}}
                  GH_TOKEN: ${{secrets.GITHUB_TOKEN}}
